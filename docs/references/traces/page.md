# Tracing

Tracing is a powerful tool for gaining insights into your application's behaviour, identifying bottlenecks, and improving system performance. A trace is a tree of spans. It is a collective of observable signals showing the path of work through a system. A trace on its own is distinguishable by a `TraceID`. 

To know more about Tracing click [here](https://opentelemetry.io/docs/concepts/data-sources/#traces).

## Automated Tracing with GoFr

GoFr makes it easy to use tracing by automatically adding traces to all requests and responses. GoFr uses [OpenTelemetry](https://opentelemetry.io/docs/concepts/what-is-opentelemetry/), a popular tracing framework, to automatically add traces to all requests and responses. OpenTelemetry provides a vendor-neutral way to collect and export tracing data. This allows you to use your preferred tracing exporter, such as Zipkin, Jaeger, or Google Cloud Trace.

## Enabling tracing in Gofr

GOFR tracing can be enabled to instrument trace data to [Zipkin](https://zipkin.io/) or GCP([Google Cloud Trace](https://cloud.google.com/trace)) based on the configs.

#### Configs to use Zipkin as a tracing system

```bash
# Tracing  
TRACER_EXPORTER=zipkin 
TRACER_URL=http://localhost:2005
```


> **NOTE**: To run zipkin docker container locally, please use the following docker command: ```docker run --name gofr-zipkin -p 2005:9411 -d openzipkin/zipkin:latest```


#### Configs to use GCP as a tracing system

```bash
# Tracing  
TRACER_EXPORTER=GCP 
GCP_PROJECT_ID=my-sample-project-12345
```

## GoFr's Automatic Correlation ID Propagation:

When a request enters your GoFr application, GoFr automatically generates a correlation ID and adds it to the request headers. This correlation ID is then propagated to all downstream requests. This means that you can track a request as it travels through your distributed system by simply looking at the correlation ID in the request headers.

> **NOTE**: Users can also specify their own correlation ID by passing it in the `X-Correlation-ID` or `X-B3-TraceID` request header. The `X-B3-TraceID` header overrides the `X-Correlation-ID` header.

-   **Nomenclature to specify a correlation ID**: If the service has no inherent unique ID that can be used as the value of this attribute it is recommended to generate a random Version 1 or Version 4 RFC 4122 UUID (services aiming for reproducible UUIDs may also use Version 5, see RFC 4122 for more recommendations).
    
-   Correlation ID is auto generated by the framework in the following conditions:
    
    1.  If the correlation ID passed via headers do not abide by the Nomenclature.
        
    2.  If no correlation ID is passed via headers.
    

## Miscellaneous

#### Grafana Tempo

-   Grafana Tempo is an open-source, easy-to-use, and high-scale distributed tracing backend.
    
-   Tempo is cost-efficient, requiring only object storage to operate, and is deeply integrated with Grafana, Prometheus, and Loki.
    
-   Tempo can ingest common open-source tracing protocols, including Jaeger, Zipkin, and OpenTelemetry.
    

**Architecture of Grafana Tempo**:
![enter image description here](https://d33wubrfki0l68.cloudfront.net/5b5eae889b3e9f6cfb07bc6a47468d6a769eee4c/b9626/img/blog/2021/09/grafana_tempo_architecture-min.webp) 

**Querying a trace on Grafana Tempo using a Trace ID**
![enter image description here](https://d33wubrfki0l68.cloudfront.net/a2b0c88107e1e00d6e8871132a0ae08d53578478/7a144/img/blog/2021/09/grafana_tempo_trace_query-min.webp)

